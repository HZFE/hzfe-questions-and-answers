(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{244:function(t,e,s){"use strict";s.r(e);var r=s(0),n=Object(r.a)({},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),t._m(8),t._v(" "),t._m(9),t._v(" "),t._m(10),t._v(" "),t._m(11),t._v(" "),s("p",[t._v("出于安全原因，浏览器限制了从 script 中发起的 cross-origin HTTP 请求。例如 XMLHttpRequest 和 Fetch 等 APIs 遵循同源策略。因此，除非使用 CORS ，否则使用这些 APIs 的应用只能从加载该应用的相同域中，请求 HTTP 资源。")]),t._v(" "),t._m(12),t._v(" "),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),t._m(16),t._v(" "),t._m(17),t._v(" "),s("p",[t._v("假设我们有一个跨域 GET 请求：")]),t._v(" "),t._m(18),t._m(19),t._v(" "),s("p",[t._v("因为非简单请求可能会影响用户数据，所以他会经过一层 preflight：先通过 OPTIONS method 向另一个域上的资源发送 HTTP request 以确定是否可以安全发送 actual request 。")]),t._v(" "),s("p",[t._v("满足以下任何一种情况，则需要 preflight：")]),t._v(" "),t._m(20),t._v(" "),s("p",[t._v("假设我们有一个跨域 POST 请求，带有复杂请求头：")]),t._v(" "),t._m(21),t._m(22),t._m(23),t._v(" "),s("p",[s("a",{attrs:{href:"https://stackoverflow.com/questions/3839966/can-anyone-explain-what-jsonp-is-in-layman-terms",target:"_blank",rel:"noopener noreferrer"}},[t._v("stackoverflow - what is jsonp"),s("OutboundLink")],1),t._v(" "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS",target:"_blank",rel:"noopener noreferrer"}},[t._v("MDN - CORS"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"http://yincheng.site/cross-domain",target:"_blank",rel:"noopener noreferrer"}},[t._v("同源策略和跨域请求研究"),s("OutboundLink")],1),t._v(" "),s("a",{attrs:{href:"https://juejin.im/post/5a6320d56fb9a01cb64ee191",target:"_blank",rel:"noopener noreferrer"}},[t._v("我知道的跨域与安全"),s("OutboundLink")],1)])])},[function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"面试题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#面试题","aria-hidden":"true"}},[this._v("#")]),this._v(" 面试题")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ol",[s("li",[s("p",[t._v("为什么存在跨域这个问题？")]),t._v(" "),s("p",[t._v("因为"),s("strong",[t._v("浏览器")]),t._v("中存在"),s("strong",[t._v("同源策略")])])]),t._v(" "),s("li",[s("p",[t._v("同源策略是什么？为什么要有同源策略？")]),t._v(" "),s("p",[t._v("如果两个页面的"),s("strong",[t._v("协议")]),t._v("，"),s("strong",[t._v("端口")]),t._v("（如果有指定）和"),s("strong",[t._v("域名")]),t._v("都相同，则两个页面具有相同的源。浏览器对 JavaScript 实施的安全限制，限制了不同源之间的交互，叫同源策略。这是为了预防某些恶意行为。")])]),t._v(" "),s("li",[s("p",[t._v("跨域有哪些常用方法？")]),t._v(" "),s("ul",[s("li",[t._v("jsonp 跨域")]),t._v(" "),s("li",[t._v("CORS")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"jsonp"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#jsonp","aria-hidden":"true"}},[this._v("#")]),this._v(" jsonp")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("JSONP")]),this._v(": JSON with Padding or JSON-P[1]。他允许绕过同源策略共享数据。但由于固有的不安全性，"),e("code",[this._v("JSONP")]),this._v(" 正在被 "),e("code",[this._v("CORS")]),this._v(" 所取代。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"how"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#how","aria-hidden":"true"}},[this._v("#")]),this._v(" how")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("如何绕过同源策略？")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("对于每个新的 "),s("code",[t._v("JSONP")]),t._v(" 请求，浏览器都必须添加一个新的 "),s("code",[t._v("<script>")]),t._v(" 元素，或复用现有的。对于"),s("strong",[t._v("添加一个新的 "),s("code",[t._v("<script>")]),t._v(" 元素")]),t._v("，是通过动态 "),s("code",[t._v("DOM")]),t._v(" 操作完成的。将 "),s("code",[t._v("<script>")]),t._v(" 元素注入到 HTML DOM 中，并将所需要请求的 URL 赋值给 "),s("code",[t._v("src")]),t._v(" 属性。这个 URL 需要携带一个 "),s("code",[t._v("callback")]),t._v(" 参数，因此服务器能知道用于包装响应的回调函数名称(JSON 响应和 JSONP 响应的区别就在于， JSONP 响应对象需要作为参数传递给回调函数)。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",{attrs:{start:"0"}},[e("li",[this._v("创建 script 标签，指定 src 属性值，并将该 script 标签嵌入 DOM 中；")]),this._v(" "),e("li",[this._v("浏览器立即获取该 script 资源，立即执行资源中代码；")]),this._v(" "),e("li",[this._v("执行结果（响应对象）作为参数传递给回调函数（i.e. 资源请求完成时，该回调函数必须已存在于全局作用域中）；")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"why"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#why","aria-hidden":"true"}},[this._v("#")]),this._v(" why")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("存在安全隐患，建议使用 "),e("code",[this._v("CORS")]),this._v(" 替代。")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[s("p",[t._v("不可信的第三方代码")]),t._v(" "),s("p",[t._v("使用远程网站的 script 标签会让远程网站得以注入"),s("strong",[t._v("任何")]),t._v("的内容至网站里。如果远程的网站有 JavaScript 注入漏洞，原来的网站也会受到影响。")])]),t._v(" "),s("li",[s("p",[t._v("回调名称操作和反射文件下载攻击")]),t._v(" "),s("p",[t._v("未经把控的回调名称可以被用来传递恶意数据给客户端，绕过 application/json 类型相关的限制，比如2014年反射文件下载（RFD）攻击所示。")])]),t._v(" "),s("li",[s("p",[t._v("跨网站请求伪造 CSRF")]),t._v(" "),s("p",[t._v("由于HTML "),s("code",[t._v("<script>")]),t._v(" 标签在网络浏览器实现中不遵守同源策略，因此恶意页面可以请求并获取属于其他站点的 JSON 数据。这将允许在恶意页面的上下文中处理这些数据，如果用户当前登录到其他站点，则可能泄漏了密码或其他敏感数据。")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"cors"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cors","aria-hidden":"true"}},[this._v("#")]),this._v(" CORS")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("CORS")]),this._v(' [Cross-Origin Resource Sharing 跨源资源共享]是一种机制，它的工作原理是，添加额外的 HTTP Headers 来让服务器描述允许使用浏览器读取某一资源的一组 origin 。该机制要求浏览器对可能给服务器数据造成 side-effects 的 HTTP request 进行预检 (preflight) ：使用 HTTP OPTIONS 请求方法从服务器请求回 supported methods 后，在服务器 "approval" 的前提下，使用实际的 HTTP method 来发送 request。')])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("需要用到 "),e("code",[this._v("CORS")]),this._v(" 的比如有：")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",[e("li",[this._v("跨域使用 XMLHttpRequest / Fetch APIs")]),this._v(" "),e("li",[this._v("Web 字体（CSS @font-face中的跨域字体）")]),this._v(" "),e("li",[this._v("使用 drawImage 绘制到 canvas 的images / video frames")]),this._v(" "),e("li",[this._v("WebGL textures ...")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"cors-例子1-简单请求"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cors-例子1-简单请求","aria-hidden":"true"}},[this._v("#")]),this._v(" CORS 例子1: 简单请求")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("不会触发 "),e("code",[this._v("CORS preflight")]),this._v(" 的被称为 simple requests，simple request 满足以下特点：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[t._v("GET | HEAD | POST")]),t._v(" "),s("li",[t._v("除浏览器自动设置的 Headers ，可以设置以下 Headers（CORS 安全首部字段集合）\n"),s("ul",[s("li",[t._v("Accept")]),t._v(" "),s("li",[t._v("Accept-Language")]),t._v(" "),s("li",[t._v("Content-Language")]),t._v(" "),s("li",[t._v("Last-Event-ID")]),t._v(" "),s("li",[t._v("DPR")]),t._v(" "),s("li",[t._v("Save-Data")]),t._v(" "),s("li",[t._v("Viewport-Width")]),t._v(" "),s("li",[t._v("Width")]),t._v(" "),s("li",[t._v("Content-Type\n"),s("ul",[s("li",[t._v("application/x-www-form-urlencoded")]),t._v(" "),s("li",[t._v("multipart/form-data")]),t._v(" "),s("li",[t._v("text/plain")])])])])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("# request headers")]),t._v("\nGET /resources/public-data/ HTTP/1.1\n"),s("span",{attrs:{class:"token comment"}},[t._v("# ......")]),t._v("\nOrigin: http://foo.example\n\n"),s("span",{attrs:{class:"token comment"}},[t._v("# response headers")]),t._v("\nHTTP/1.1 200 OK\n"),s("span",{attrs:{class:"token comment"}},[t._v("# ......")]),t._v("\nAccess-Control-Allow-Origin: *\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"cors-例子2-预检请求"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cors-例子2-预检请求","aria-hidden":"true"}},[this._v("#")]),this._v(" CORS 例子2: 预检请求")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("PUT | DELETE | CONNECT | OPTIONS | TRACE | PATCH")]),this._v(" "),e("li",[this._v("前面 simple request 的 headers 列表中没有提到的")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{attrs:{class:"token string"}},[t._v("'X-PINGOTHER'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'pingpong'")]),t._v("\n"),s("span",{attrs:{class:"token string"}},[t._v("'Content-Type'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'application/xml'")]),t._v("\n")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("# preflight request headers")]),t._v("\nOPTIONS /resources/post-here/ HTTP/1.1\n"),s("span",{attrs:{class:"token comment"}},[t._v("# ......")]),t._v("\nOrigin: http://foo.example\nAccess-Control-Request-Method: POST\nAccess-Control-Request-Headers: X-PINGOTHER, Content-Type\n\n"),s("span",{attrs:{class:"token comment"}},[t._v("# preflight response headers")]),t._v("\nHTTP/1.1 200 OK\n"),s("span",{attrs:{class:"token comment"}},[t._v("# ......")]),t._v("\nAccess-Control-Allow-Origin: http://foo.example\nAccess-Control-Allow-Methods: POST, GET\nAccess-Control-Allow-Headers: X-PINGOTHER, Content-Type\nAccess-Control-Max-Age: 86400\n\n"),s("span",{attrs:{class:"token comment"}},[t._v("# actual request header")]),t._v("\nPOST /resources/post-here/ HTTP/1.1\n"),s("span",{attrs:{class:"token comment"}},[t._v("# ......")]),t._v("\nX-PINGOTHER: pingpong\nContent-Type: text/xml"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" charset"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("UTF-8\nOrigin: http://foo.example\n\n"),s("span",{attrs:{class:"token comment"}},[t._v("# actual response header")]),t._v("\nHTTP/1.1 200 OK\n"),s("span",{attrs:{class:"token comment"}},[t._v("# ......")]),t._v("\nAccess-Control-Allow-Origin: http://foo.example\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"学习资料"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#学习资料","aria-hidden":"true"}},[this._v("#")]),this._v(" 学习资料")])}],!1,null,null,null);e.default=n.exports}}]);